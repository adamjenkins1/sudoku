!function(n,r,e){"use strict";r.fn.sudokuJS=function(e){function t(r){n.console&&console.log&&console.log(r)}function a(){for(var n=w.length,r=0;r<n;r++)for(var e=0;e<u;e++)for(var t=w[r][e],a=$(t),i=0;i<u;i++){var l=t[i];E[l].candidates;D(l,a)}return!1}function i(n){function r(e,t){for(var a=Math.max(t,d[t]);a<u-n+t;a++){d[t]=a+1,d[t+1]=a+1;var i=e[a],f=_(i);if(!(0===f.length||f.length>n)){if(l.length>0){for(var s=f.slice(),v=0;v<l.length;v++)for(var c=l[v].candidates,g=0;g<c.length;g++)U(s,c[g])||s.push(c[g]);if(s.length>n)continue}if(l.push({cell:i,candidates:f}),t<n-1){var p=r(e,t+1);if(!1!==p)return p}if(l.length===n){for(var m=[],y=[],C=0;C<l.length;C++)m.push(l[C].cell),y=y.concat(l[C].candidates);for(var F=[],M=0;M<u;M++)U(m,e[M])||F.push(e[M]);var k=G(F,y);if(k.length>0)return h===o&&H(y,m),b=!0,q(k)}}}return t>0&&l.length>t-1&&l.pop(),!1}for(var e=w.length,t=0;t<e;t++)for(var a=0;a<u;a++){var i=w[t][a];if(!(Z(i).length<=n)){var l=[],d=[-1],f=r(i,0);if(!1!==f)return f}}return!1}function l(n){function r(e,t){for(var a=Math.max(t,d[t]);a<=u-n+t;a++){d[t]=a+1,d[t+1]=a+1;var i=a+1,f=nn(i,e);if(!(0===f.length||f.length>n)){if(l.length>0){for(var s=f.slice(),v=0;v<l.length;v++)for(var c=l[v].cells,g=0;g<c.length;g++)U(s,c[g])||s.push(c[g]);if(s.length>n)continue}if(l.push({candidate:i,cells:f}),t<n-1){var p=r(e,t+1);if(!1!==p)return p}if(l.length===n){for(var m=[],y=[],C=0;C<l.length;C++)m.push(l[C].candidate),y=y.concat(l[C].cells);for(var F=[],M=0;M<u;M++)U(m,M+1)||F.push(M+1);if(G(y,F).length>0)return h===o&&H(m,y),b=!0,q(y)}}}return t>0&&l.length>t-1&&l.pop(),!1}for(var e=w.length,t=0;t<e;t++)for(var a=0;a<u;a++){var i=w[t][a];if(!(Z(i).length<=n)){var l=[],d=[-1],f=r(i,0);if(!1!==f)return f}}return!1}var o="step",d=["easy","medium","hard","very hard"];e=e||{};var u,f,s,v,h=o,c="unknown",g=!1,p=!1,m=!1,y=!1,b=!1,C=!1,F=!1,M=[],k=[{title:"openSingles",fn:function(){for(var n=w.length,r=0;r<n;r++)for(var e=0,t=0;t<u;t++){for(var a=[],i=0;i<u;i++){var l=w[r][t][i];if(null===E[l].val&&(a.push({house:w[r][t],cell:l}),a.length>1))break}if(1===a.length){var d=a[0],f=Z(d.house);return f.length>1?(y=!0,-1):(W(d.cell,f[0]),h===o&&A(d.cell,f[0]),[d.cell])}if(0===a.length&&++e===u)return m=!0,-1}return!1},score:.1},{title:"singleCandidate",fn:function(){a();for(var n=0;n<E.length;n++){for(var r=E[n].candidates,e=[],t=0;t<r.length&&(null!==r[t]&&e.push(r[t]),!(e.length>1));t++);if(1===e.length){var i=e[0];return W(n,i),h===o&&A(n,i),b=!1,[n]}}return!1},score:9},{title:"visualElimination",fn:function(){for(var n=w.length,r=0;r<n;r++)for(var e=0;e<u;e++)for(var t=w[r][e],a=Z(t),i=0;i<a.length;i++){for(var l=a[i],d=[],f=0;f<u;f++){var s=t[f],v=E[s];if(U(v.candidates,l)&&(d.push(s),d.length>1))break}if(1===d.length){var c=d[0];return W(c,l),h===o&&A(c,l),b=!1,[c]}}return!1},score:8},{title:"nakedPair",fn:function(){return i(2)},score:50},{title:"pointingElimination",fn:function(){for(var n=w.length,r=0;r<n;r++)for(var e=r,t=0;t<u;t++)for(var a=w[e][t],i=Z(a),l=0;l<i.length;l++){for(var d=i[l],f=!0,s=-1,v=-1,c=!0,g=[],p=0;p<a.length;p++){var m=a[p];if(U(E[m].candidates,d)){var y=Y(m),C=2===e?y[0]:y[2],F=2===e?y[1]:y[2];if(g.length>0&&(C!==s&&(f=!1),v!==F&&(c=!1),!1===f&&!1===c))break;s=C,v=F,g.push(m)}}if((!0===f||!0===c)&&g.length>0){var M=Y(g[0]),k=2;2===e&&(k=f?0:1);for(var S=w[k][M[k]],B=[],q=0;q<S.length;q++)U(g,S[q])||B.push(S[q]);var z=G(B,[d]);if(z.length>0)return h===o&&H([d],g),b=!0,z}}return!1},score:80},{title:"hiddenPair",fn:function(){return l(2)},score:90},{title:"nakedTriplet",fn:function(){return i(3)},score:100},{title:"hiddenTriplet",fn:function(){return l(3)},score:140},{title:"nakedQuad",fn:function(){return i(4)},score:150},{title:"hiddenQuad",fn:function(){return l(4)},score:280}],S=[],E=[],w=[[],[],[]],B=r(this),U=function(n,r){for(var e=0;e<n.length;e++)if(n[e]===r)return!0;return!1},q=function(n){for(var r={},e=0;e<n.length;e++)r[n[e]]=!0;var t=[];for(var a in r)t.push(a);return t},z=function(n){var r={};n.length<3?r.level="easy":n.length<4?r.level="medium":r.level="hard";for(var e=0,t=0;t<k.length;t++){var a=n[t];a&&(e+=a*k[t].score)}return r.score=e,e>750&&(r.level="very hard"),r},I=function(){for(var n=0;n<u*u;n++)if(null===E[n].val)return!1;return!0},J=function(){w=[[],[],[]];for(var n=Math.sqrt(u),r=0;r<u;r++){for(var e=[],t=[],a=[],i=0;i<u;i++)if(e.push(u*r+i),t.push(u*i+r),i<n)for(var l=0;l<n;l++){var o=Math.floor(r/n)*u*n+r%n*n;a.push(o+u*i+l)}w[0].push(e),w[1].push(t),w[2].push(a)}},x=function(n){var r=null!==E[0]&&"object"==typeof E[0],e=[];if(f=[],u=!E.length&&n.boardSize||Math.sqrt(E.length)||9,B.attr("data-board-size",u),u%1!=0||Math.sqrt(u)%1!=0)return t("invalid boardSize: "+u),void("function"==typeof n.boardErrorFn&&n.boardErrorFn({msg:"invalid board size"}));for(var a=0;a<u;a++)f.push(a+1),e.push(null);if(J(),!r)for(var i=0;i<u*u;i++){var l=void 0===E[i]?null:E[i],o=null===l?f.slice():e.slice();E[i]={val:l,candidates:o}}},N=function(){for(var n="",r=0;r<u*u;r++)n+=O(E[r],r),(r+1)%u==0&&(n+="<br>");B.append(n),s=B.find("input"),v=B.find(".candidates")},O=function(n,r){var e=null===n.val?"":n.val,t=n.candidates||[],a=T(t);return"<div class='sudoku-board-cell'><input type='text' pattern='\\d*' novalidate id='input-"+r+"' value='"+e+"'"+(u<10?" maxlength='1'":"")+"><div id='input-"+r+"-candidates' class='candidates'>"+a+"</div></div>"},T=function(n){for(var r="",e=1;e<u+1;e++)U(n,e)?r+="<div>"+e+"</div> ":r+="<div>&nbsp;</div> ";return r},Q=function(n){s.removeClass("highlight-val").each(function(e,t){var a=r(this),i=E[e].val;a.val(i),n&&a.addClass("highlight-val"),a.siblings(".candidates").html(T(E[e].candidates))})},j=function(n,e){e=e||{};var t=E[n].val;r("#input-"+n).val(t).addClass("highlight-val"),r("#input-"+n+"-candidates").html(T(E[n].candidates))},P=function(n,e){r("#input-"+n+"-candidates div:nth-of-type("+e+")").addClass("candidate--to-remove")},A=function(n,e){r("#input-"+n+"-candidates div:nth-of-type("+e+")").addClass("candidate--highlight")},D=function(n,r){for(var e=E[n].candidates,t=!1,a=0;a<r.length;a++)null!==e[r[a]-1]&&(e[r[a]-1]=null,t=!0);t&&h===o&&j(n,{mode:"only-candidates"})},G=function(n,r){for(var e=[],t=0;t<n.length;t++)for(var a=E[n[t]].candidates,i=0;i<r.length;i++){var l=r[i];null!==a[l-1]&&(a[l-1]=null,e.push(n[t]),h===o&&P(n[t],l))}return e},H=function(n,r){for(var e=0;e<r.length;e++)for(var t=E[r[e]].candidates,a=0;a<t.length;a++)U(n,t[a])&&A(r[e],t[a])},K=function(){m=!1,y=!1,b=!1,S=[],C=!1},L=function(){K();for(var n=f.slice(0),r=0;r<u*u;r++)E[r]={val:null,candidates:n.slice()};s.removeClass("highlight-val").val(""),Q(!1)},R=function(){for(var n=[],r=0;r<u;r++)n.push(null);return n},V=function(n){for(var e=f.slice(0),t=0;t<u*u;t++)null===E[t].val?(E[t].candidates=e.slice(),!1!==n&&r("#input-"+t+"-candidates").html(T(e))):!1!==n&&r("#input-"+t+"-candidates").html("")},W=function(n,r){var e=E[n];e.val=r,null!==r&&(e.candidates=R())},X=function(n,r){for(var e=0;e<u;e++)if(E[r[e]].val===n)return e;return!1},Y=function(n){var r=Math.sqrt(u),e=[],t=Math.floor(n/u);e.push(t);var a=Math.floor(n%u);e.push(a);var i=Math.floor(t/r)*r+Math.floor(a/r);return e.push(i),e},Z=function(n){for(var r=f.slice(),e=0;e<n.length;e++)for(var t=0;t<r.length;t++)r[t]===E[n[e]].val&&r.splice(t,1);return r},$=function(n){for(var r=[],e=0;e<n.length;e++){var t=E[n[e]].val;null!==t&&r.push(t)}return r},_=function(n){for(var r=[],e=E[n].candidates,t=0;t<e.length;t++)null!==e[t]&&r.push(e[t]);return r},nn=function(n,r){for(var e=[],t=0;t<r.length;t++){var a=E[r[t]].candidates;U(a,n)&&e.push(r[t])}return e},rn=0,en=!1,tn=function(n){if(m)return C||(Q(!1),"function"==typeof e.boardFinishedFn&&e.boardFinishedFn({difficultyInfo:z(S)})),!1;if(h===o&&en&&-1!==en){s.removeClass("highlight-val"),r(".candidate--highlight").removeClass("candidate--highlight");for(var t=0;t<en.length;t++)j(en[t])}rn++;var a=k[n].fn;if(!1===(en=a()))return k.length>n+1?tn(n+1):("function"!=typeof e.boardErrorFn||F||e.boardErrorFn({msg:"no more strategies"}),C||F||"all"!==h||Q(!1),!1);if(y)return"function"==typeof e.boardErrorFn&&e.boardErrorFn({msg:"Board incorrect"}),"all"===h&&Q(!1),!1;if(h===o&&("function"==typeof e.boardUpdatedFn&&e.boardUpdatedFn({cause:k[n].title,cellsUpdated:en}),I()&&(m=!0,"function"==typeof e.boardFinishedFn&&e.boardFinishedFn({difficultyInfo:z(S)}),g&&Q(!1)),!g&&!b&&en&&-1!==en)){s.removeClass("highlight-val"),r(".candidate--highlight").removeClass("candidate--highlight");for(var i=0;i<en.length;i++)j(en[i])}return void 0===S[n]&&(S[n]=0),S[n]=S[n]+1,C||g||!b||(gn(),"function"==typeof e.candidateShowToggleFn&&e.candidateShowToggleFn(!0)),!0},an=function(n,e){var t=n;39===e?t++:37===e?t--:40===e?t+=u:38===e&&(t-=u),t<0||t>u*u||r("#input-"+t).focus()},ln=function(n,r){var e=E[r];if(!e.val){var t=e.candidates;t[n-1]=null===t[n-1]?n:null,h===o&&j(r,{mode:"only-candidates"})}},on=function(n,i){var l=parseInt(n.val());if(p)return ln(l,i),void n.val(E[i].val);var o=R();if(l>0){for(var d=Y(i),u=0;u<w.length;u++)if(X(l,w[u][d[u]])){var v=w[u][d[u]][X(l,w[u][d[u]])];if(v===i)continue;return void r("#input-"+v+", #input-"+i).addClass("board-cell--error")}n.siblings(".candidates").html(T(o)),E[i].candidates=o,E[i].val=l,I()&&(m=!0,t("user finished board!"),"function"==typeof e.boardFinishedFn&&e.boardFinishedFn({}))}else y=!1,l=null,o=f.slice(),n.siblings(".candidates").html(T(o)),E[i].val=l,V(),a();r("#input-"+i).hasClass("board-cell--error")&&s.removeClass("board-cell--error"),"function"==typeof e.boardUpdatedFn&&e.boardUpdatedFn({cause:"user input",cellsUpdated:[i]}),b=!1},dn=function(){C=!0,h="all";for(var n=JSON.parse(JSON.stringify(S)),r=JSON.parse(JSON.stringify(E)),e=!0;e;)e=tn(b?2:0);var t={};if(y)t.error="Board incorrect";else{t.finished=m,t.usedStrategies=[];for(var a=0;a<S.length;a++){var i=k[a];void 0!==S[a]&&(t.usedStrategies[a]={title:i.title,freq:S[a]})}if(m){var l=z(S);t.level=l.level,t.score=l.score}}return K(),S=n,E=r,t},un=function(n,r){a();var e=M&&M[n],t=E[n].candidates.filter(function(n){return!(!n||e&&U(e,n))&&n});if(0===t.length)return!1;var i=t[Math.round(Math.random()*(t.length-1))];return W(n,i),!0},fn=function(n){if(n+1>u*u)return M=[],!0;if(!un(n)){if(n<=0)return!1;var r=n-1;return M[r]=M[r]||[],M[r].push(E[r].val),W(r,null),V(!1),M[n]=[],fn(r),!1}fn(n+1)},sn=function(n){return"easy"===n.level||("medium"===n.level?"easy"!==c:"hard"===n.level?"easy"!==c&&"medium"!==c:"very hard"===n.level?"easy"!==c&&"medium"!==c&&"hard"!==c:void 0)},vn=function(n){return"easy"===c||("medium"===c?"easy"!==n.level:"hard"===c?"easy"!==n.level&&"medium"!==n.level:"very hard"===c?"easy"!==n.level&&"medium"!==n.level&&"hard"!==n.level:void 0)},hn=function(){var n=[],r=u*u,e=17;"easy"===c?e=40:"medium"===c&&(e=30),u<9&&(e=4);for(var t=0;t<u*u;t++)n.push(t);for(;n.length>0&&r>e;){var a=Math.round(Math.random()*(n.length-1)),i=n.splice(a,1),l=E[i].val;W(i,null),V(!1);var o=dn();!1!==o.finished&&sn(o)?r--:W(i,l)}},cn=function(n,r){s&&L(),c=U(d,n)?n:u>=9?"medium":"easy",F=!0,h="all",fn(0);for(var e=E.slice(),t=!0;t;){hn();var i=dn();vn(i)?t=!1:E=e}h=o,s&&Q(),a(),"function"==typeof r&&r()};e.board?(E=e.board,x(),N(),a()):(x(e),cn(e),N()),s.on("keyup",function(n){var e=r(this),t=parseInt(e.attr("id").replace("input-",""));n.keyCode>=37&&n.keyCode<=40&&an(t,n.keyCode)}),s.on("change",function(){var n=r(this),e=parseInt(n.attr("id").replace("input-",""));on(n,e)});var gn=function(){B.addClass("showCandidates"),g=!0};return{solveAll:function(){h="all";for(var n=!0;n;)n=tn(b?2:0)},solveStep:function(){h=o,tn(b?2:0)},analyzeBoard:dn,clearBoard:L,getBoard:function(){return E},setBoard:function(n){L(),E=n,x(),a(),Q(!1)},hideCandidates:function(){B.removeClass("showCandidates"),g=!1},showCandidates:gn,setEditingCandidates:function(n){p=n},generateBoard:cn}}}(window,jQuery);